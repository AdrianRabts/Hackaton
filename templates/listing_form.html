{% extends "base.html" %}
{% block content %}

<div class="flex items-start justify-between gap-4 flex-wrap">
  <div>
    <h1 class="text-2xl font-bold">
      {% if mode == "edit" %}Editar lugar{% else %}Nuevo lugar{% endif %}
    </h1>
    <p class="text-slate-600">
      Crea un “producto claro”: ruta + categoría + precio + duración + contacto. Lo demás es ruido.
    </p>
  </div>
  <a href="/listings" class="px-3 py-2 rounded-lg bg-white border hover:bg-slate-100">Volver</a>
</div>

<div class="mt-6 bg-white border rounded-2xl p-6">
  <form method="post"
        action="{% if mode == 'edit' %}/listings/{{ listing.id }}/update{% else %}/listings{% endif %}"
        class="grid gap-5">

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="text-sm text-slate-600">Ruta</label>
        <select name="route" class="w-full px-3 py-2 border rounded-lg" required>
          {% set current_route = listing.route if listing else "" %}
          <option value="Ruta Spondylus / Montañita" {% if current_route=="Ruta Spondylus / Montañita" %}selected{% endif %}>Ruta Spondylus / Montañita</option>
          <option value="Cuenca" {% if current_route=="Cuenca" %}selected{% endif %}>Cuenca</option>
          <option value="Tena" {% if current_route=="Tena" %}selected{% endif %}>Tena</option>
        </select>
      </div>

      <div>
        <label class="text-sm text-slate-600">Categoría</label>
        <select name="category" class="w-full px-3 py-2 border rounded-lg" required>
          {% set current_cat = listing.category if listing else "" %}
          <option value="comida" {% if current_cat=="comida" %}selected{% endif %}>comida</option>
          <option value="historico" {% if current_cat=="historico" %}selected{% endif %}>historico</option>
          <option value="parque" {% if current_cat=="parque" %}selected{% endif %}>parque</option>
          <option value="artesania" {% if current_cat=="artesania" %}selected{% endif %}>artesania</option>
        </select>
      </div>
    </div>

    <div>
      <label class="text-sm text-slate-600">Título</label>
      <input name="title" type="text" required
             value="{{ listing.title if listing else '' }}"
             class="w-full px-3 py-2 border rounded-lg" />
    </div>

    <div>
      <label class="text-sm text-slate-600">Descripción corta</label>
      <textarea name="short_desc" rows="3" required
                class="w-full px-3 py-2 border rounded-lg">{{ listing.short_desc if listing else '' }}</textarea>
      <p class="text-xs text-slate-500 mt-1">
        Tip: que suene a experiencia cultural, no a “anuncio genérico”.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="text-sm text-slate-600">Precio (USD)</label>
        <input name="price_usd" type="number" min="0" step="0.5" required
               value="{{ listing.price_usd if listing else 0 }}"
               class="w-full px-3 py-2 border rounded-lg" />
      </div>

      <div>
        <label class="text-sm text-slate-600">Duración (min)</label>
        <input name="duration_min" type="number" min="0" step="5" required
               value="{{ listing.duration_min if listing else 60 }}"
               class="w-full px-3 py-2 border rounded-lg" />
      </div>

      <div>
        <label class="text-sm text-slate-600">Dirección</label>
        <input name="address" type="text" required
               value="{{ listing.address if listing else '' }}"
               class="w-full px-3 py-2 border rounded-lg" />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="text-sm text-slate-600">Maps URL (opcional)</label>
        <input name="maps_url" type="url"
               value="{{ listing.maps_url if listing else '' }}"
               class="w-full px-3 py-2 border rounded-lg" />
      </div>

      <div>
        <label class="text-sm text-slate-600">WhatsApp (opcional)</label>
        <input name="contact_whatsapp" type="text"
               value="{{ listing.contact_whatsapp if listing else '' }}"
               placeholder="+5939..."
               class="w-full px-3 py-2 border rounded-lg" />
      </div>

      <div>
        <label class="text-sm text-slate-600">TikTok URL (opcional)</label>
        <input name="tiktok_url" type="url"
               value="{{ listing.tiktok_url if listing else '' }}"
               class="w-full px-3 py-2 border rounded-lg" />
      </div>
    </div>

    <div>
      <label class="text-sm text-slate-600">Tags (separados por coma)</label>
      <input name="tags" type="text"
             value="{% if mode == 'edit' %}{{ listing.tags_str if listing else '' }}{% else %}{{ listing.tags | join(', ') if listing and listing.tags else '' }}{% endif %}"
             placeholder="compra_local, autentico, lluvia_ok, familias"
             class="w-full px-3 py-2 border rounded-lg" />
      <p class="text-xs text-slate-500 mt-1">
        Ejemplo: <span class="font-semibold">compra_local, autentico, lluvia_ok</span>
      </p>
    </div>

    <div class="flex items-center justify-between flex-wrap gap-3 pt-2">
      <div class="text-xs text-slate-500">
        Hackathon mode: mejor guardar data buena que pelear con formularios raros.
      </div>

      <button class="px-4 py-2 rounded-lg bg-slate-900 text-white hover:bg-slate-800">
        {% if mode == "edit" %}Guardar cambios{% else %}Crear lugar{% endif %}
      </button>
    </div>
  </form>
</div>

{% endblock %}
